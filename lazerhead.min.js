var consts={ground:500,playerW:50,playerH:126,initialPower:25,wallCount:7,starsCount:250};function lavaBallEffect(){this.age=0;this.maxage=800;this.size=rand(20,50);this.x=player.x-350;this.y=rand(consts.ground-this.size,0);this.box=new Box(this.x+0.15*this.size,this.y+0.15*this.size,0.7*this.size,0.7*this.size);this.dx=rand(2,4);this.tick=function(){this.age++;this.x+=this.dx;this.box.x+=this.dx;this.box.intersects(player)&&(effects.push(new superTextEffect("ouch!",20,player.x,player.y)),player.y-=10,player.x+=30,this.age=this.maxage,player.damage(this.size*this.size))};this.draw=function(a){a.save();
a.fillStyle="#dd2222";this.box.fillRect(a);a.globalAlpha=0.6;a.fillStyle="#dddd22";a.fillRect(this.x,this.y,this.size,this.size);a.restore()};this.isAlive=function(){return this.age<this.maxage}}
function superTextEffect(a,b,c,d){this.text=a;this.x=c;this.y=d;this.age=0;this.maxage=b;this.tick=function(){this.age++};this.draw=function(a){a.save();a.fillStyle="#FFFF00";a.font="bold 40px sans-serif";a.fillText(this.text,this.x,this.y);a.restore()};this.isAlive=function(){return this.age<this.maxage}}
function risingLineEffect(){this.x=rand(player.x-20-player.power/5,player.x+player.w+20+player.power/5);this.y=player.y+player.h;this.length=rand(player.power/5,player.power/2);this.width=player.power/25;this.dy=rand(2,6);this.age=0;this.maxage=rand(5,10);this.tick=function(){this.age++;this.y-=this.dy};this.draw=function(a){a.save();a.globalAlpha=rand(0.1,0.5);a.strokeStyle="yellow";a.lineWidth=this.width;a.beginPath();a.moveTo(this.x,this.y);a.lineTo(this.x,this.y-this.length);a.stroke();a.restore()};
this.isAlive=function(){return this.age<this.maxage}}
function hurtEffect(){this.x=player.x+rand(-15,15)+player.w;this.y=player.y+15+rand(-15,15);this.dx=rand(3,3);this.dy=rand(3,3);this.rad=rand(3,10);this.alpha=rand(0.5,0.8);this.dalpha=rand(0.8,0.95);this.age=0;this.maxage=rand(15,30);this.tick=function(){this.age++;this.x-=this.dx;this.y-=this.dy;this.rad+=1;this.alpha*=this.dalpha};this.draw=function(a){a.save();a.fillStyle="#444444";a.globalAlpha=this.alpha;a.beginPath();a.arc(this.x,this.y,this.rad,0,2*Math.PI,!0);a.closePath();a.fill();a.restore()};
this.isAlive=function(){return this.age<this.maxage}}function boxDamageEffect(a){this.box=a;this.age=0;this.maxage=4;this.damageColor="#ffff00";this.tick=function(){this.age++};this.draw=function(a){a.fillStyle=this.damageColor;this.box.fillRect(a)};this.isAlive=function(){return this.age<this.maxage}}
function lazerEffect(a,b){this.x=a;this.dx=5;this.y=b;this.age=0;this.maxage=2*player.power;this.alive=!0;this.power=player.power;this.color="#ff0000";this.tick=function(){this.age++;for(var a=!0,b=0;b<walls.length;b++)walls[b].intersectedByPoint(this.x+this.radius(),this.y)&&this.alive&&(a=!1,this.age+=5,walls[b].damage(this.radius()));a&&(this.x+=this.dx);this.age>this.maxage&&(this.alive=!1)};this.radius=function(){return 0.5*this.power*(1-this.age/this.maxage)+0.4*this.power};this.draw=function(a){this.alive&&
(a.save(),a.fillStyle=this.color,a.globalAlpha=rand(0.2,0.1),a.beginPath(),a.arc(this.x+this.radius(),this.y,this.radius(),0,2*Math.PI,!0),a.closePath(),a.fill(),a.restore())};this.isAlive=function(){return this.age<this.maxage}};for(var skyline1=[],i=0;200>i;i++)skyline1[i]=rand(20,250);for(var skyline2=[],i=0;100>i;i++)skyline2[i]=rand(50,200);for(var skyline3=[],skyline3dists=[],skyline3widths=[],i=0;100>i;i++)skyline3[i]=rand(250,400),skyline3dists[i]=rand(250,500),skyline3widths[i]=rand(50,100);for(var starxs=[],starys=[],starrads=[],i=0;i<consts.starsCount;i++)starxs.push(rand(-50,1E3)),starys.push(rand(0,consts.ground)),starrads.push(rand(1,4));
function drawBackground(a){a.fillStyle="#111122";a.fillRect(0,0,800,600)}function drawGround(a){a.fillStyle="#555555";a.fillRect(0,500,800,100)}function drawStarfield(a){a.save();a.translate(-camera/10,0);for(var b=0;b<consts.starsCount;b++)a.fillStyle="#ffffaa;",a.beginPath(),rdiff=rand(0.9,1.1),a.arc(starxs[b],starys[b],starrads[b]*rdiff,0,2*Math.PI,!0),a.closePath(),a.fill();a.restore()}
function drawSkyline1(a){a.save();a.translate(-camera/3,0);a.fillStyle="#222230";for(var b in skyline1){var c=skyline1[b];a.fillRect(25*b-200,consts.ground-c,26,c)}a.restore()}function drawSkyline2(a){a.save();a.translate(-camera/2,0);a.fillStyle="#333344";for(var b in skyline2){var c=skyline2[b];a.fillRect(50*b-200,consts.ground-c,51,c)}a.restore()}
function drawSkyline3(a){a.save();a.translate(-camera/1.3,0);a.fillStyle="#555567";for(var b in skyline3){var c=skyline3[b];a.fillRect(b*skyline3dists[b],consts.ground-c,skyline3widths[b],c)}a.restore()};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();function rand(a,b){return a+Math.random()*(b-a)}function randColor(){return"#"+Math.floor(16777215*Math.random()).toString(16)}var effects=[],camera=0,ctx=document.getElementById("canvas").getContext("2d"),pressed={},player=new Box(0,300,consts.playerW,consts.playerH),playerAnim={},sprite=new Image;sprite.src="sprites.png";
for(var jumping=!1,charging=!1,playerDied=!1,gameWon=!1,walls=[],nextWall=300,i=0;i<consts.wallCount;i++){var height=rand(250,400),width=rand(50+5*i,100+5*i);walls.push(new Box(nextWall,consts.ground-height,width,height));var dist=rand(100,500),nextWall=nextWall+(width+dist)}walls.push(new Box(nextWall-20,consts.ground-450,300,450));var magicDoor=new Box(nextWall+50,consts.ground-126,50,126);
function setup(){document.addEventListener("keydown",function(a){pressed[a.keyCode]=!0});document.addEventListener("keyup",function(a){pressed[a.keyCode]=!1});player.dy=0;player.power=25;player.maxpower=150;playerAnim.idle=[];playerAnim.running=[];for(var a=0;4>a;a++)playerAnim.idle.push({x:64*a,y:0}),playerAnim.running.push({x:64*a,y:64});playerAnim.index=0;playerAnim.name="idle"}
function gameLoop(){updateGameState();checkConditions();processAnimations();draw();cleanUp();window.requestAnimFrame(gameLoop)}
function updateGameState(){if(playerDied)return!1;playerAnim.name="idle";charging=!1;!0==pressed[76]&&(player.power<player.maxpower?(console.log("Aaaaaaaaaaa!!!"),player.power+=0.5):console.log("MAX POWER!"),charging=!0,effects.push(new risingLineEffect));!0!=pressed[65]||charging||(player.x-=3,playerAnim.name="running");!0!=pressed[68]||charging||(player.x+=3,playerAnim.name="running");!0!=pressed[32]||charging?jumping=!1:!jumping&&0<player.getBottom()&&(player.dy-=20,jumping=!0);!0!=pressed[74]||
charging||(effects.push(new lazerEffect(player.x+player.w-10,player.y+20)),player.getBottom()<consts.ground?player.x-=0.0010*Math.pow(player.power,2):player.x-=3.25E-4*Math.pow(player.power,2),10<player.power&&(player.power-=0.1));if(!0!=pressed[74]||20>player.power)player.y+=player.dy,player.dy+=1;camera=player.x-200;99<rand(0,100)&&effects.push(new lavaBallEffect);updateWalls();player.updateStatus();0<player.health&&Math.random()>(player.health/(player.w*player.h)||0)&&effects.push(new hurtEffect)}
function updateWalls(){walls.forEach(function(a){a.updateStatus()})}function resetGame(){effects=[];gameWon?effects.push(new superTextEffect("Welcome back champion!!!",100,0,300)):effects.push(new superTextEffect("Welcome back!",100,0,300));gameWon=playerDied=!1;player.x=0;player.y=300;player.power=consts.initialPower;player.health=player.h*player.w;walls.forEach(function(a){a.health=a.h*a.w})}
function checkConditions(){player.intersects(magicDoor)&&(gameWon||(effects=[],gameWon=!0,setTimeout(resetGame,800)),effects.push(new superTextEffect("YOU WIN!!!",rand(20,50),rand(player.x-150,player.x+player.w+150),rand(player.y-150,player.y+150))));0>=player.health&&!playerDied&&(playerDied=!0,effects.push(new superTextEffect("YOU DEAD!!!!!!",60,player.x,player.y)),setTimeout(resetGame,800));walls.forEach(function(a){player.intersects(a)&&(player.damage(500),player.y-=4,player.x-=10,effects.push(new superTextEffect("Owweee!",
30,player.x,player.y)))});player.getBottom()>consts.ground&&(player.dy=0,player.setBottom(consts.ground));0>player.getBottom()&&(player.y=0,player.dy=0);-300>player.getLeft()&&(effects.push(new lavaBallEffect),effects.push(new lavaBallEffect),effects.push(new lavaBallEffect))}var tick=0;function processAnimations(){tick++;0==tick%6&&playerAnim.index++;playerAnim.index>=playerAnim[playerAnim.name].length&&(playerAnim.index=0)}
function drawMagicDoor(a){a.save();a.fillStyle=randColor();magicDoor.fillRect(a);a.restore()}function drawPlayer(a){if(0>=player.health)return!1;a.save();a.translate(player.x,player.y);var b=playerAnim[playerAnim.name][playerAnim.index];a.imageSmoothingEnabled=!1;a.mozImageSmoothingEnabled=!1;a.webkitImageSmoothingEnabled=!1;a.drawImage(sprite,b.x,b.y,64,64,-96,-88,256,256);a.restore()}function drawWalls(a){a.fillStyle="#a9a9a9";walls.forEach(function(b){0<b.health&&b.fillRect(a)})}
function drawEffects(a){effects.forEach(function(b){b.tick();b.draw(a)})}function draw(){drawBackground(ctx);drawStarfield(ctx);drawSkyline1(ctx);drawSkyline2(ctx);drawSkyline3(ctx);drawGround(ctx);ctx.save();ctx.translate(-camera,0);drawMagicDoor(ctx);drawPlayer(ctx);drawWalls(ctx);drawEffects(ctx);ctx.restore()}
function Box(a,b,c,d){this.x=a;this.y=b;this.w=c;this.h=d;this.health=this.w*this.h;this.damageCooldown=0;this.fillRect=function(a){a.fillRect(this.x,this.y,this.w,this.h)};this.getRight=function(){return this.x+this.w};this.getLeft=function(){return this.x};this.getTop=function(){return this.y};this.getBottom=function(){return this.y+this.h};this.setRight=function(a){this.x=a-this.w};this.setLeft=function(a){this.x=a};this.setBottom=function(a){this.y=a-this.h};this.setTop=function(a){this.y=a};
this.intersects=function(a){return 0>=a.health||0>=this.health?!1:this.getRight()>=a.getLeft()&&this.getLeft()<=a.getRight()&&this.getBottom()>=a.getTop()&&this.getTop()<=a.getBottom()?!0:!1};this.intersectedByPoint=function(a,b){return 0>=this.health?!1:this.getRight()>=a&&this.getLeft()<=a&&this.getBottom()>=b&&this.getTop()<=b?!0:!1};this.damage=function(a){this.health-=a;0==this.damageCooldown&&(this.damageCooldown=5,effects.push(new boxDamageEffect(this)))};this.updateStatus=function(){0<this.damageCooldown&&
this.damageCooldown--}}function cleanUp(){effects=effects.filter(function(a){return a.isAlive()})}setup();effects.push(new superTextEffect("Welcome to Lazerhead!!!",100,0,300));window.requestAnimFrame(gameLoop);
